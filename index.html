<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è²ªé£Ÿè›‡ Snake + è‹±æ–‡å–®å­—æ¨¡å¼</title>
  <style>
    :root{
      --bg:#0f172a;
      --panel:#111827cc;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --accent-2:#16a34a;
      --danger:#ef4444;
      --grid:#1f2937;
      --cell:#0b1224;
      --tile1:#f59e0b; /* amber-500 */
      --tile2:#b45309; /* amber-700 */
      --ok:#34d399;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 70% -10%, #1f2937, var(--bg));
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Noto Sans,"Helvetica Neue",Arial;
      color:var(--text); display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .app{ width: min(100%, 820px); }
    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    .title{ font-weight:800; letter-spacing:.5px; font-size: clamp(20px, 3vw, 28px);}
    .panel{ background:linear-gradient(180deg, #0b1224, #0a0f1f); border:1px solid #1f2937; border-radius:16px; box-shadow:0 10px 30px #0008; }
    .hud{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; gap:10px; flex-wrap:wrap }
    .hud .stat{ display:flex; gap:6px; align-items:center; font-variant-numeric: tabular-nums; }
    .hud .stat b{ font-size:18px }
    .hud .chip{ padding:6px 10px; border-radius:999px; background:#0b1224; border:1px solid #1f2937; color:var(--muted)}

    .wordbox{ display:flex; align-items:center; gap:10px; }
    #wordView{ font-weight:800; letter-spacing:2px; font-size: clamp(16px, 3vw, 22px)}
    #wordView .ok{ color:var(--ok) }
    #wordView .todo{ color:var(--muted) }
    #nextLetter{ padding:2px 8px; border-radius:10px; border:1px dashed #334155; color:#f8fafc; background:#0b1224 }

    .canvas-wrap{ position:relative; padding:12px; }
    canvas{ width:100%; height:auto; display:block; background:linear-gradient(180deg, #0a1326, #091021); border-radius:12px; border:1px solid #1e293b; }

    .controls{ display:grid; grid-template-columns:1fr auto; gap:12px; padding:12px 16px; border-top:1px solid #1e293b; }
    .btn{ background:#0b1224; border:1px solid #1f2937; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
    .btn:hover{ background:#0e1630 }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background:linear-gradient(180deg, var(--accent), var(--accent-2)); border-color:#065f46 }

    .dpad{ display:grid; grid-template-columns:64px 64px 64px; grid-template-rows:64px 64px 64px; gap:10px; justify-content:center; margin-left:auto; }
    .dpad .pad{ display:flex; align-items:center; justify-content:center; background:#0b1224; border:1px solid #1f2937; border-radius:14px; font-size:20px; cursor:pointer; }
    .pad.empty{ visibility:hidden }

    .footer{ margin-top:14px; color:var(--muted); font-size:12px; text-align:center }
    .links{ display:flex; gap:10px; justify-content:center; margin-top:6px }
    .link{ color:#93c5fd; text-decoration:none }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">ğŸŸ© è²ªé£Ÿè›‡ Snake Â· è‹±æ–‡å–®å­—æ¨¡å¼</div>
      <div class="chip" id="status" style="display:none"></div>
    </div>

    <div class="panel hud">
      <div class="stat">åˆ†æ•¸ï¼š<b id="score">0</b></div>
      <div class="stat">æœ€ä½³ï¼š<b id="best">0</b></div>
      <div class="stat chip">é€Ÿåº¦ï¼š<b id="speedLabel">ä¸­ç­‰</b></div>
      <div class="stat chip">å‰©é¤˜å–®å­—ï¼š<b id="leftCnt">0</b></div>
      <div class="wordbox">
        <span>å–®å­—ï¼š</span>
        <span id="wordView"><span class="ok"></span><span class="todo"></span></span>
        <span>ä¸‹ä¸€å­—æ¯ï¼š<span id="nextLetter">â€”</span></span>
      </div>
    </div>

    <div class="panel canvas-wrap">
      <canvas id="game" width="560" height="560"></canvas>
    </div>

    <div class="panel controls">
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
        <button class="btn primary" id="toggle">é–‹å§‹</button>
        <button class="btn" id="reset">é‡ä¾†</button>
        <label class="btn">ç¢°å£ï¼š
          <select id="wallMode">
            <option value="solid">çµæŸ</option>
            <option value="wrap">ç©¿ç‰†</option>
          </select>
        </label>
        <label class="btn">é€Ÿåº¦ï¼š
          <select id="speed">
            <option value="150">æ‚ é–’</option>
            <option value="110" selected>ä¸­ç­‰</option>
            <option value="80">å¿«é€Ÿ</option>
            <option value="55">ç‹‚ç†±</option>
          </select>
        </label>
        <span class="btn" style="pointer-events:none;opacity:.8">å–®å­—ä¾†æºï¼šenglish.txtï¼ˆåŒç›®éŒ„ï¼‰</span>
      </div>
    </div>

    <div class="footer">
      æ“ä½œï¼šæ–¹å‘éµ / WASDã€ç©ºç™½éµæš«åœã€Enter é‡ä¾†ã€æ‰‹æ©Ÿå¯æ»‘å‹•æ“æ§ã€‚
    </div>
  </div>

  <script>
    const GRID = 28;
    const CELL = 20;
    const CANVAS_SIZE = GRID * CELL;

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = CANVAS_SIZE; canvas.height = CANVAS_SIZE;

    // resolve CSS var colors
    const cssVars = getComputedStyle(document.documentElement);
    const COLORS = {
      tile1: (cssVars.getPropertyValue('--tile1') || '#f59e0b').trim(),
      tile2: (cssVars.getPropertyValue('--tile2') || '#b45309').trim(),
    };

    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const speedSel = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');
    const wallModeSel = document.getElementById('wallMode');
    const toggleBtn = document.getElementById('toggle');
    const resetBtn = document.getElementById('reset');
    const statusChip = document.getElementById('status');
    const leftCntEl = document.getElementById('leftCnt');
    const wordView = document.getElementById('wordView');
    const nextLetterEl = document.getElementById('nextLetter');

    const BEST_KEY = 'snake_best_score_v1';

    function normalizeWord(w){
      const s = (w||'').toUpperCase().replace(/[^A-Z]/g,'');
      return s.length? s : null;
    }
    function parseWordText(text){
      const raw = text.split(/\\r?\\n|,|;|\\t/g).map(s=>s.trim());
      const arr = [];
      const seen = new Set();
      for(const r of raw){
        const n = normalizeWord(r);
        if(n && !seen.has(n)) { arr.push(n); seen.add(n); }
      }
      return arr;
    }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

    let state = { running:false, over:false, cleared:false, tickMs:parseInt(speedSel.value,10),
      wallMode:wallModeSel.value, score:0, best:parseInt(localStorage.getItem(BEST_KEY)||'0',10),
      dir:{x:1,y:0}, nextDir:{x:1,y:0}, queue:[], snake:[], food:null, timer:null,
      originalWords:[], wordsQueue:[], currentWord:null, progress:0 };

    function init(){ /* ...åŒå‰çœç•¥ï¼Œé‚è¼¯ä¸è®Š... */ }

    // (çœç•¥ï¼šéŠæˆ²æ ¸å¿ƒç¨‹å¼å’Œ draw å‡½å¼)
    // åœ¨ draw() è£¡ä½¿ç”¨:
    // grd.addColorStop(0, COLORS.tile1);
    // grd.addColorStop(1, COLORS.tile2);

    // å¾ english.txt è¼‰å…¥ã€boot() ç­‰ä¿æŒä¸è®Š
  </script>
</body>
</html>
